---
description: Methods for Fit, Predict, Forecast (fast), Cross Validation and plotting
output-file: core.html
title: Core Methods

---

The core methods of
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
are:

-   `StatsForecast.fit`
-   `StatsForecast.predict`
-   [`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
-   [`StatsForecast.cross_validation`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.cross_validation)
-   `StatsForecast.plot`

```python
def test_gp_df(df, sort_df):
    df = df.set_index("ds", append=True)
    if not df.index.is_monotonic_increasing and sort_df:
        df = df.sort_index()
    data = df.values.astype(np.float32)
    indices_sizes = df.index.get_level_values("unique_id").value_counts(sort=False)
    indices = indices_sizes.index
    sizes = indices_sizes.values
    cum_sizes = sizes.cumsum()
    dates = df.index.get_level_values("ds")[cum_sizes - 1]
    indptr = np.append(0, cum_sizes).astype(np.int32)
    return GroupedArray(data, indptr), indices, dates, df.index
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1849"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast

> ``` text
>  StatsForecast (models:List[Any], freq:str, n_jobs:int=1, df:Union[pandas.
>                 core.frame.DataFrame,polars.dataframe.frame.DataFrame,None
>                 Type]=None, sort_df:bool=True,
>                 fallback_model:Optional[Any]=None, verbose:bool=False)
> ```

Train statistical models.

The
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
class allows you to efficiently fit multiple
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
models for large sets of time series. It operates with pandas DataFrame
`df` that identifies series and datestamps with the `unique_id` and `ds`
columns. The `y` column denotes the target time series variable.

The class has memory-efficient
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
method that avoids storing partial model outputs. While the
`StatsForecast.fit` and `StatsForecast.predict` methods with
Scikit-learn interface store the fitted models.

The
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
class offers parallelization utilities with Dask, Spark and Ray
back-ends. See distributed computing example
[here](https://github.com/Nixtla/statsforecast/tree/main/experiments/ray).

|                | **Type** | **Default** | **Details**                                                                                                                                                                                                                                                 |
|------|------------------|-------------------------|-------------------------|
| models         | List     |             | List of instantiated objects models.StatsForecast.                                                                                                                                                                                                          |
| freq           | str      |             | Frequency of the data.<br>See [panda’s available frequencies](https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases).                                                                                                      |
| n_jobs         | int      | 1           | Number of jobs used in the parallel processing, use -1 for all cores.                                                                                                                                                                                       |
| df             | Union    | None        | DataFrame with columns \[`unique_id`, `ds`, `y`\] and exogenous.                                                                                                                                                                                            |
| sort_df        | bool     | True        | If True, sort `df` by \[`unique_id`,`ds`\].                                                                                                                                                                                                                 |
| fallback_model | Optional | None        | Model to be used if a model fails. <br>Only works with the [`forecast`](https://Nixtla.github.io/statsforecast/src/ets.html#forecast) and [`cross_validation`](https://Nixtla.github.io/statsforecast/src/distributed.utils.html#cross_validation) methods. |
| verbose        | bool     | False       | Prints TQDM progress bar when `n_jobs=1`.                                                                                                                                                                                                                   |

```python
# StatsForecast's class usage example

#from statsforecast.core import StatsForecast
from statsforecast.models import ( 
    ADIDA,
    AutoARIMA,
    CrostonClassic,
    CrostonOptimized,
    CrostonSBA,
    HistoricAverage,
    IMAPA,
    Naive,
    RandomWalkWithDrift,
    SeasonalExponentialSmoothing,
    SeasonalNaive,
    SeasonalWindowAverage,
    SimpleExponentialSmoothing,
    TSB,
    WindowAverage,
    DynamicOptimizedTheta,
    AutoETS,
    AutoCES
)

# Generate synthetic panel DataFrame for example
panel_df = generate_series(n_series=9, equal_ends=False, engine='pandas')
panel_df.groupby('unique_id').tail(4)
```

|           | y        | ds         |
|-----------|----------|------------|
| unique_id |          |            |
| 0         | 1.212726 | 2000-08-06 |
| 0         | 2.442669 | 2000-08-07 |
| 0         | 3.339940 | 2000-08-08 |
| 0         | 4.228065 | 2000-08-09 |
| 1         | 0.048275 | 2000-04-03 |
| 1         | 1.128070 | 2000-04-04 |
| 1         | 2.295968 | 2000-04-05 |
| 1         | 3.238239 | 2000-04-06 |
| 2         | 6.480128 | 2000-06-12 |
| 2         | 0.036217 | 2000-06-13 |
| 2         | 1.009650 | 2000-06-14 |
| 2         | 2.489787 | 2000-06-15 |
| 3         | 3.289840 | 2000-08-26 |
| 3         | 4.227949 | 2000-08-27 |
| 3         | 5.321176 | 2000-08-28 |
| 3         | 6.127013 | 2000-08-29 |
| 4         | 5.403709 | 2001-01-04 |
| 4         | 6.081779 | 2001-01-05 |
| 4         | 0.438420 | 2001-01-06 |
| 4         | 1.386855 | 2001-01-07 |
| 5         | 5.011166 | 2000-10-24 |
| 5         | 6.397153 | 2000-10-25 |
| 5         | 0.462146 | 2000-10-26 |
| 5         | 1.253125 | 2000-10-27 |
| 6         | 5.407805 | 2000-08-29 |
| 6         | 6.340789 | 2000-08-30 |
| 6         | 0.202894 | 2000-08-31 |
| 6         | 1.491204 | 2000-09-01 |
| 7         | 1.068102 | 2001-02-09 |
| 7         | 2.233974 | 2001-02-10 |
| 7         | 3.484143 | 2001-02-11 |
| 7         | 4.176505 | 2001-02-12 |
| 8         | 4.110373 | 2000-02-25 |
| 8         | 5.483879 | 2000-02-26 |
| 8         | 6.068916 | 2000-02-27 |
| 8         | 0.040499 | 2000-02-28 |

```python
# Declare list of instantiated StatsForecast estimators to be fitted
# You can try other estimator's hyperparameters
# You can try other methods from the `models.StatsForecast` collection
# Check them here: https://nixtla.github.io/statsforecast/models.html
models=[AutoARIMA(), Naive(), 
        AutoETS(), AutoARIMA(allowmean=True, alias='MeanAutoARIMA')] 

# Instantiate StatsForecast class
fcst = StatsForecast(df=panel_df,
                     models=models,
                     freq='D', 
                     n_jobs=1, 
                     verbose=True)

# Efficiently predict
fcsts_df = fcst.forecast(h=4, fitted=True)
fcsts_df.groupby('unique_id').tail(4)
```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L850"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.fit

> ``` text
>  StatsForecast.fit (df:Union[pandas.core.frame.DataFrame,polars.dataframe.
>                     frame.DataFrame,NoneType]=None, sort_df:bool=True, pre
>                     diction_intervals:Optional[statsforecast.utils.Conform
>                     alIntervals]=None)
> ```

Fit statistical models.

Fit `models` to a large set of time series from DataFrame `df` and store
fitted models for later inspection.

|                      | **Type**          | **Default** | **Details**                                                                                                                                                                                                                    |
|------|------------------|-------------------------|-------------------------|
| df                   | Union             | None        | DataFrame with columns \[`unique_id`, `ds`, `y`\] and exogenous.<br>If None, the [`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast) class should have been instantiated<br>using `df`. |
| sort_df              | bool              | True        | If True, sort `df` by \[`unique_id`,`ds`\].                                                                                                                                                                                    |
| prediction_intervals | Optional          | None        | Configuration to calibrate prediction intervals (Conformal Prediction).                                                                                                                                                        |
| **Returns**          | **StatsForecast** |             | **Returns with stored [`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast) fitted `models`.**                                                                                            |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L937"
target="_blank" style="float:right; font-size:smaller">source</a>

## SatstForecast.predict

> ``` text
>  SatstForecast.predict (h:int, X_df:Union[pandas.core.frame.DataFrame,pola
>                         rs.dataframe.frame.DataFrame,NoneType]=None,
>                         level:Optional[List[int]]=None)
> ```

Predict statistical models.

Use stored fitted `models` to predict large set of time series from
DataFrame `df`.

|             | **Type**                                 | **Default** | **Details**                                                                                                         |
|------|------------------|-------------------------|-------------------------|
| h           | int                                      |             | Forecast horizon.                                                                                                   |
| X_df        | Union                                    | None        | DataFrame with \[`unique_id`, `ds`\] columns and `df`’s future exogenous.                                           |
| level       | Optional                                 | None        | Confidence levels between 0 and 100 for prediction intervals.                                                       |
| **Returns** | **pandas.DataFrame \| polars.DataFrame** |             | **DataFrame with `models` columns for point predictions and probabilistic<br>predictions for all fitted `models`.** |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L983"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.fit_predict

> ``` text
>  StatsForecast.fit_predict (h:int, df:Union[pandas.core.frame.DataFrame,po
>                             lars.dataframe.frame.DataFrame,NoneType]=None,
>                             X_df:Union[pandas.core.frame.DataFrame,polars.
>                             dataframe.frame.DataFrame,NoneType]=None,
>                             level:Optional[List[int]]=None,
>                             sort_df:bool=True, prediction_intervals:Option
>                             al[statsforecast.utils.ConformalIntervals]=Non
>                             e)
> ```

Fit and Predict with statistical models.

This method avoids memory burden due from object storage. It is
analogous to Scikit-Learn `fit_predict` without storing information. It
requires the forecast horizon `h` in advance.

In contrast to
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
this method stores partial models outputs.

|                      | **Type**                                 | **Default** | **Details**                                                                                                                                                                                                                              |
|------|------------------|-------------------------|-------------------------|
| h                    | int                                      |             | Forecast horizon.                                                                                                                                                                                                                        |
| df                   | Union                                    | None        | DataFrame with columns \[`unique_id`, `ds`, `y`\] and exogenous variables.<br>If None, the [`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast) class should have been instantiated<br>using `df`. |
| X_df                 | Union                                    | None        | DataFrame with \[`unique_id`, `ds`\] columns and `df`’s future exogenous.                                                                                                                                                                |
| level                | Optional                                 | None        | Confidence levels between 0 and 100 for prediction intervals.                                                                                                                                                                            |
| sort_df              | bool                                     | True        | If True, sort `df` by \[`unique_id`,`ds`\].                                                                                                                                                                                              |
| prediction_intervals | Optional                                 | None        | Configuration to calibrate prediction intervals (Conformal Prediction).                                                                                                                                                                  |
| **Returns**          | **pandas.DataFrame \| polars.DataFrame** |             | **DataFrame with `models` columns for point predictions and probabilistic<br>predictions for all fitted `models`.**                                                                                                                      |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1042"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.forecast

> ``` text
>  StatsForecast.forecast (h:int, df:Union[pandas.core.frame.DataFrame,polar
>                          s.dataframe.frame.DataFrame,NoneType]=None, X_df:
>                          Union[pandas.core.frame.DataFrame,polars.datafram
>                          e.frame.DataFrame,NoneType]=None,
>                          level:Optional[List[int]]=None,
>                          fitted:bool=False, sort_df:bool=True, prediction_
>                          intervals:Optional[statsforecast.utils.ConformalI
>                          ntervals]=None)
> ```

Memory Efficient predictions.

This method avoids memory burden due from object storage. It is
analogous to Scikit-Learn `fit_predict` without storing information. It
requires the forecast horizon `h` in advance.

|                      | **Type**                                 | **Default** | **Details**                                                                                                                                                                                                                    |
|------|------------------|-------------------------|-------------------------|
| h                    | int                                      |             | Forecast horizon.                                                                                                                                                                                                              |
| df                   | Union                                    | None        | DataFrame with columns \[`unique_id`, `ds`, `y`\] and exogenous.<br>If None, the [`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast) class should have been instantiated<br>using `df`. |
| X_df                 | Union                                    | None        | DataFrame with \[`unique_id`, `ds`\] columns and `df`’s future exogenous.                                                                                                                                                      |
| level                | Optional                                 | None        | Confidence levels between 0 and 100 for prediction intervals.                                                                                                                                                                  |
| fitted               | bool                                     | False       | Wether or not return insample predictions.                                                                                                                                                                                     |
| sort_df              | bool                                     | True        | If True, sort `df` by \[`unique_id`,`ds`\].                                                                                                                                                                                    |
| prediction_intervals | Optional                                 | None        | Configuration to calibrate prediction intervals (Conformal Prediction).                                                                                                                                                        |
| **Returns**          | **pandas.DataFrame \| polars.DataFrame** |             | **DataFrame with `models` columns for point predictions and probabilistic<br>predictions for all fitted `models`.**                                                                                                            |

```python
# StatsForecast.forecast method usage example

#from statsforecast.core import StatsForecast
from statsforecast.utils import AirPassengersDF as panel_df
from statsforecast.models import AutoARIMA, Naive

# Instantiate StatsForecast class
fcst = StatsForecast(df=panel_df,
                     models=[AutoARIMA(), Naive()],
                     freq='D', n_jobs=1)

# Efficiently predict without storing memory
fcsts_df = fcst.forecast(h=4, fitted=True)
fcsts_df.groupby('unique_id').tail(4)
```

|           | ds         | AutoARIMA  | Naive |
|-----------|------------|------------|-------|
| unique_id |            |            |       |
| 1.0       | 1961-01-01 | 476.006500 | 432.0 |
| 1.0       | 1961-01-02 | 482.846222 | 432.0 |
| 1.0       | 1961-01-03 | 512.423523 | 432.0 |
| 1.0       | 1961-01-04 | 502.038269 | 432.0 |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1106"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.forecast_fitted_values

> ``` text
>  StatsForecast.forecast_fitted_values ()
> ```

Access insample predictions.

After executing
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast),
you can access the insample prediction values for each model. To get
them, you need to pass `fitted=True` to the
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
method and then use the `StatsForecast.forecast_fitted_values` method.

```python
# StatsForecast.forecast_fitted_values method usage example

#from statsforecast.core import StatsForecast
from statsforecast.utils import AirPassengersDF as panel_df
from statsforecast.models import Naive

# Instantiate StatsForecast class
fcst = StatsForecast(df=panel_df,
                     models=[AutoARIMA()],
                     freq='D', n_jobs=1)

# Access insample predictions
fcsts_df = fcst.forecast(h=12, fitted=True, level=(90, 10))
insample_fcsts_df = fcst.forecast_fitted_values()
insample_fcsts_df.tail(4)
```

|           | ds         | y     | AutoARIMA  | AutoARIMA-lo-90 | AutoARIMA-lo-10 | AutoARIMA-hi-10 | AutoARIMA-hi-90 |
|-----------|------------|-------|------------|-----------------|-----------------|-----------------|-----------------|
| unique_id |            |       |            |                 |                 |                 |                 |
| 1.0       | 1960-09-30 | 508.0 | 572.654175 | 525.092163      | 569.020630      | 576.287781      | 620.216187      |
| 1.0       | 1960-10-31 | 461.0 | 451.528259 | 403.966248      | 447.894684      | 455.161835      | 499.090271      |
| 1.0       | 1960-11-30 | 390.0 | 437.915375 | 390.353363      | 434.281799      | 441.548981      | 485.477386      |
| 1.0       | 1960-12-31 | 432.0 | 369.718781 | 322.156769      | 366.085205      | 373.352356      | 417.280792      |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1136"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.cross_validation

> ``` text
>  StatsForecast.cross_validation (h:int, df:Union[pandas.core.frame.DataFra
>                                  me,polars.dataframe.frame.DataFrame,NoneT
>                                  ype]=None, n_windows:int=1,
>                                  step_size:int=1,
>                                  test_size:Optional[int]=None,
>                                  input_size:Optional[int]=None,
>                                  level:Optional[List[int]]=None,
>                                  fitted:bool=False, refit:bool=True,
>                                  sort_df:bool=True, prediction_intervals:O
>                                  ptional[statsforecast.utils.ConformalInte
>                                  rvals]=None)
> ```

Temporal Cross-Validation.

Efficiently fits a list of
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
models through multiple training windows, in either chained or rolled
manner.

`StatsForecast.models`’ speed allows to overcome this evaluation
technique high computational costs. Temporal cross-validation provides
better model’s generalization measurements by increasing the test’s
length and diversity.

|                      | **Type**             | **Default** | **Details**                                                                                                                                                                                                                    |
|------|------------------|-------------------------|-------------------------|
| h                    | int                  |             | Forecast horizon.                                                                                                                                                                                                              |
| df                   | Union                | None        | DataFrame with columns \[`unique_id`, `ds`, `y`\] and exogenous.<br>If None, the [`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast) class should have been instantiated<br>using `df`. |
| n_windows            | int                  | 1           | Number of windows used for cross validation.                                                                                                                                                                                   |
| step_size            | int                  | 1           | Step size between each window.                                                                                                                                                                                                 |
| test_size            | Optional             | None        | Length of test size. If passed, set `n_windows=None`.                                                                                                                                                                          |
| input_size           | Optional             | None        | Input size for each window, if not none rolled windows.                                                                                                                                                                        |
| level                | Optional             | None        | Confidence levels between 0 and 100 for prediction intervals.                                                                                                                                                                  |
| fitted               | bool                 | False       | Wether or not returns insample predictions.                                                                                                                                                                                    |
| refit                | bool                 | True        | Wether or not refit the model for each window.                                                                                                                                                                                 |
| sort_df              | bool                 | True        | If True, sort `df` by `unique_id` and `ds`.                                                                                                                                                                                    |
| prediction_intervals | Optional             | None        | Configuration to calibrate prediction intervals (Conformal Prediction).                                                                                                                                                        |
| **Returns**          | **pandas.DataFrame** |             | **DataFrame with insample `models` columns for point predictions and probabilistic<br>predictions for all fitted `models`.**                                                                                                   |

```python
# StatsForecast.crossvalidation method usage example

#from statsforecast.core import StatsForecast
from statsforecast.utils import AirPassengersDF as panel_df
from statsforecast.models import Naive

# Instantiate StatsForecast class
fcst = StatsForecast(df=panel_df,
                     models=[Naive()],
                     freq='D', n_jobs=1, verbose=True)

# Access insample predictions
rolled_fcsts_df = fcst.cross_validation(14, n_windows=2)
rolled_fcsts_df.head(4)
```

``` text
Cross Validation Time Series 1:   0%|          | 0/2 [00:00<?, ?it/s]Cross Validation Time Series 1: 100%|##########| 2/2 [00:00<00:00, 9320.68it/s]
```

|           | ds         | cutoff     | y     | Naive |
|-----------|------------|------------|-------|-------|
| unique_id |            |            |       |       |
| 1.0       | 1960-12-17 | 1960-12-16 | 407.0 | 463.0 |
| 1.0       | 1960-12-18 | 1960-12-16 | 362.0 | 463.0 |
| 1.0       | 1960-12-19 | 1960-12-16 | 405.0 | 463.0 |
| 1.0       | 1960-12-20 | 1960-12-16 | 417.0 | 463.0 |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1261"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.cross_validation_fitted_values

> ``` text
>  StatsForecast.cross_validation_fitted_values ()
> ```

Access insample cross validated predictions.

After executing
[`StatsForecast.cross_validation`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.cross_validation),
you can access the insample prediction values for each model and window.
To get them, you need to pass `fitted=True` to the
[`StatsForecast.cross_validation`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.cross_validation)
method and then use the `StatsForecast.cross_validation_fitted_values`
method.

```python
# StatsForecast.cross_validation_fitted_values method usage example

#from statsforecast.core import StatsForecast
from statsforecast.utils import AirPassengersDF as panel_df
from statsforecast.models import Naive

# Instantiate StatsForecast class
fcst = StatsForecast(df=panel_df,
                     models=[Naive()],
                     freq='D', n_jobs=1)

# Access insample predictions
rolled_fcsts_df = fcst.cross_validation(h=12, n_windows=2, fitted=True)
insample_rolled_fcsts_df = fcst.cross_validation_fitted_values()
insample_rolled_fcsts_df.tail(4)
```

|           | ds         | cutoff     | y     | Naive |
|-----------|------------|------------|-------|-------|
| unique_id |            |            |       |       |
| 1.0       | 1959-09-30 | 1959-12-31 | 463.0 | 559.0 |
| 1.0       | 1959-10-31 | 1959-12-31 | 407.0 | 463.0 |
| 1.0       | 1959-11-30 | 1959-12-31 | 362.0 | 407.0 |
| 1.0       | 1959-12-31 | 1959-12-31 | 405.0 | 362.0 |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/statsforecast/blob/main/statsforecast/core.py#L1453"
target="_blank" style="float:right; font-size:smaller">source</a>

## StatsForecast.plot

> ``` text
>  StatsForecast.plot
>                      (df:Union[pandas.core.frame.DataFrame,polars.datafram
>                      e.frame.DataFrame], forecasts_df:Union[pandas.core.fr
>                      ame.DataFrame,polars.dataframe.frame.DataFrame,NoneTy
>                      pe]=None, unique_ids:Union[List[str],NoneType,numpy.n
>                      darray]=None, plot_random:bool=True,
>                      models:Optional[List[str]]=None,
>                      level:Optional[List[float]]=None,
>                      max_insample_length:Optional[int]=None,
>                      plot_anomalies:bool=False, engine:str='matplotlib',
>                      resampler_kwargs:Optional[Dict]=None)
> ```

Plot forecasts and insample values.

|                     | **Type** | **Default** | **Details**                                                                                                                                                                                              |
|------|------------------|-------------------------|-------------------------|
| df                  | Union    |             | DataFrame with columns \[`unique_id`, `ds`, `y`\].                                                                                                                                                       |
| forecasts_df        | Union    | None        | DataFrame with columns \[`unique_id`, `ds`\] and models.                                                                                                                                                 |
| unique_ids          | Union    | None        | Time Series to plot.<br>If None, time series are selected randomly.                                                                                                                                      |
| plot_random         | bool     | True        | Select time series to plot randomly.                                                                                                                                                                     |
| models              | Optional | None        | List of models to plot.                                                                                                                                                                                  |
| level               | Optional | None        | List of prediction intervals to plot if paseed.                                                                                                                                                          |
| max_insample_length | Optional | None        | Max number of train/insample observations to be plotted.                                                                                                                                                 |
| plot_anomalies      | bool     | False       | Plot anomalies for each prediction interval.                                                                                                                                                             |
| engine              | str      | matplotlib  | Library used to plot. ‘plotly’, ‘plotly-resampler’ or ‘matplotlib’.                                                                                                                                      |
| resampler_kwargs    | Optional | None        | Kwargs to be passed to plotly-resampler constructor. <br>For further custumization (“show_dash”) call the method,<br>store the plotting object and add the extra arguments to<br>its `show_dash` method. |

# Misc

## Integer datestamp

The
[`StatsForecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast)
class can also receive integers as datestamp, the following example
shows how to do it.

```python
# from statsforecast.core import StatsForecast
from statsforecast.utils import AirPassengers as ap
from statsforecast.models import HistoricAverage
```


```python
int_ds_df = pd.DataFrame({'ds': np.arange(1, len(ap) + 1), 'y': ap})
int_ds_df.insert(0, 'unique_id', 'AirPassengers')
int_ds_df.set_index('unique_id', inplace=True)
int_ds_df.head()
```


```python
int_ds_df.tail()
```


```python
int_ds_df
```


```python
fcst = StatsForecast(df=int_ds_df, models=[HistoricAverage()], freq='D')
horizon = 7
forecast = fcst.forecast(horizon)
forecast.head()
```


```python
last_date = int_ds_df['ds'].max()
test_eq(forecast['ds'].values, np.arange(last_date + 1, last_date + 1 + horizon))
```


```python
int_ds_cv = fcst.cross_validation(h=7, test_size=8, n_windows=None)
int_ds_cv
```

## External regressors

Every column after **y** is considered an external regressor and will be
passed to the models that allow them. If you use them you must supply
the future values to the
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
method.

```python
class LinearRegression:
    
    def __init__(self):
        pass
    
    def fit(self, y, X):
        self.coefs_, *_ = np.linalg.lstsq(X, y, rcond=None)
        return self
    
    def predict(self, h, X):
        mean = X @ coefs
        return mean
    
    def __repr__(self):
        return 'LinearRegression()'
    
    def forecast(self, y, h, X=None, X_future=None, fitted=False):
        coefs, *_ = np.linalg.lstsq(X, y, rcond=None)
        return {'mean': X_future @ coefs}
    
    def new(self):
        b = type(self).__new__(type(self))
        b.__dict__.update(self.__dict__)
        return b
```


```python
series_xreg = series = generate_series(10_000, equal_ends=True)
series_xreg['intercept'] = 1
series_xreg['dayofweek'] = series_xreg['ds'].dt.dayofweek
series_xreg = pd.get_dummies(series_xreg, columns=['dayofweek'], drop_first=True)
series_xreg
```


```python
dates = sorted(series_xreg['ds'].unique())
valid_start = dates[-14]
train_mask = series_xreg['ds'] < valid_start
series_train = series_xreg[train_mask]
series_valid = series_xreg[~train_mask]
X_valid = series_valid.drop(columns=['y'])
fcst = StatsForecast(
    df=series_train,
    models=[LinearRegression()],
    freq='D',
)
xreg_res = fcst.forecast(14, X_df=X_valid)
xreg_res['y'] = series_valid['y'].values
```


```python
xreg_res.groupby('ds').mean().plot()
```


```python
xreg_res_cv = fcst.cross_validation(h=3, test_size=5, n_windows=None)
```

## Prediction intervals

You can pass the argument `level` to the
[`StatsForecast.forecast`](https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast)
method to calculate prediction intervals. Not all models can calculate
them at the moment, so we will only obtain the intervals of those models
that have it implemented.

```python
ap_df = pd.DataFrame({'ds': np.arange(ap.size), 'y': ap}, index=pd.Index([0] * ap.size, name='unique_id'))
sf = StatsForecast(
    models=[
        SeasonalNaive(season_length=12), 
        AutoARIMA(season_length=12)
    ],
    freq='M',
    n_jobs=1
)
ap_ci = sf.forecast(df=ap_df, h=12, level=(80, 95))
fcst.plot(ap_df, ap_ci, level=[80], engine="matplotlib")
```

## Conformal Prediction intervals

You can also add conformal intervals using the following code.

```python
from statsforecast.utils import ConformalIntervals
```


```python
sf = StatsForecast(
    models=[
        AutoARIMA(season_length=12),
        AutoARIMA(
            season_length=12, 
            prediction_intervals=ConformalIntervals(n_windows=2, h=12),
            alias='ConformalAutoARIMA'
        ),
    ],
    freq='M',
    n_jobs=1
)
ap_ci = sf.forecast(df=ap_df, h=12, level=(80, 95))
fcst.plot(ap_df, ap_ci, level=[80], engine="plotly")
```

You can also compute conformal intervals for all the models that support
them, using the following,

```python
sf = StatsForecast(
    models=[
        AutoARIMA(season_length=12),
    ],
    freq='M',
    n_jobs=1
)
ap_ci = sf.forecast(
    df=ap_df, 
    h=12, 
    level=(50, 80, 95), 
    prediction_intervals=ConformalIntervals(h=12),
)
fcst.plot(ap_df, ap_ci, level=[80], engine="matplotlib")
```

